{%- comment -%}
    Renders list of products in grid layout

    Accepts:
    - product: {Object} product (required) 
    - carousel: {Boolean} Show the product images in carousel. Default: false

    Usage:
    {% render 'product-grid-item', product: product, carousel: carousel %}
{%- endcomment -%}

{%- liquid
  assign columns = settings.products_per_row_on_desktop | plus: 0
  assign columns_mobile = settings.products_per_row_on_mobile | plus: 0
  assign columns_small = 2

  case columns
    when 1
      assign size_desktop = 'one-whole'
    when 2
      assign size_desktop = 'one-half'
    when 3
      assign size_desktop = 'one-third'
    when 4
      assign size_desktop = 'one-quarter'
  endcase

  case columns_mobile
    when 1
      assign size_mobile = 'mobile--one-whole'
    when 2
      assign size_mobile = 'mobile--one-half'
  endcase

  if carousel == true
    assign size_mobile = 'mobile--one-whole'
  endif

  assign product_tags = product.tags | join: ',' | append: ','
  assign preorder = false
  assign on_sale = false
  assign sold_out = false
  assign badge = false
  
  if product_tags contains '_badge_'
    assign badge = product_tags | split: '_badge_'
    assign badge = badge[1] | split: ',' | first | replace: '_', ' '
  endif

  if product_tags contains '_preorder'
    assign preorder = true
  endif

  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  unless product.available
    assign sold_out = true
  endunless

  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = product.featured_media
-%}